<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
        <title>Dynamic Job Listings from Airtable</title>
        <style>
            html, body {
                padding: 0;
                margin: 0;
            }
            main.container {
                padding-left: 0 !important; /* ì™¼ìª½ íŒ¨ë”© ì œê±° */
                padding-right: 0; /* ì˜¤ë¥¸ìª½ íŒ¨ë”© ì œê±° (í•„ìš”í•œ ê²½ìš°) */
                max-width: none !important;
            }

            /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
            .sortable {
                cursor: pointer;
            }

            .sortable::after {
                content: ' \25B2';
            }
            .sortable.desc::after {
                content: ' \25BC';
            }

            thead th {
                position: sticky;
                top: 0;
                background-color: #fff;
                z-index: 10;
            }

            thead th::before {
                content: '';
                position: absolute;
                left: 0;
                bottom: -1px; /* í…Œë‘ë¦¬ë¥¼ ì…€ì˜ í•˜ë‹¨ì— ìœ„ì¹˜ì‹œí‚µë‹ˆë‹¤. */
                width: 100%;
                border-bottom: 2px solid #000; /* í•˜ë‹¨ì— ê²€ì€ìƒ‰ í…Œë‘ë¦¬ ì¶”ê°€ */
                z-index: -1;
            }
            
            .odd-row {
                background-color: #FFFFFF;
            }
            .even-row {
                background-color: #FAF6F3;
            }

            body[data-theme='dark'] .odd-row {
                background-color: #2C2C2E; /* ë‹¤í¬ëª¨ë“œì— ì í•©í•œ ë” ì–´ë‘ìš´ ìƒ‰ */
            }
            body[data-theme='dark'] .even-row {
                background-color: #3A3A3C; /* ë‹¤í¬ëª¨ë“œì— ì í•©í•œ ìƒ‰, í™€ìˆ˜ í–‰ë³´ë‹¤ ì•½ê°„ ë°ìŒ */
            }

            table {
                width: 100%; /* ì¡°ì •ëœ í…Œì´ë¸” ë„ˆë¹„ */
                table-layout: fixed;
            }
            th, td {
                padding: 3px;
                text-overflow: ellipsis;
                overflow: hidden;
                white-space: nowrap;
                text-align: center; /* ì¢Œìš° ì •ë ¬ ê¸°ë³¸ê°’ */
                border-bottom: 1px solid #dddddd;
                border-top: 1px solid #dddddd;
            }
            tr:hover {
                background-color: #f5f5f5;
            }
    
            /* 'ìš”êµ¬ ê²½ë ¥' ì¹¼ëŸ¼ í…ìŠ¤íŠ¸ ì¢Œìš° ì¤‘ì•™ ì •ë ¬ */
            td.col-experience {
                text-align: center;
            }

            #jobTable td, #jobTable th {
                padding-top: 15px; /* ì…€ ìƒë‹¨ íŒ¨ë”© */
                padding-bottom: 15px; /* ì…€ í•˜ë‹¨ íŒ¨ë”© */
            }
    
            /* ë„ë©”ì¸ í•„í„° ìŠ¤íƒ€ì¼ */
            #domainFilter {
                display: flex;
                flex-wrap: nowrap;
                overflow-x: auto;
                overflow-y: hidden;
                padding: 10px 0;
                border-bottom: 1px solid #eee;
            }
            #domainFilter label {
                margin-right: 15px;
                white-space: nowrap;
                color: #000000; /* ë¼ì´íŠ¸ ëª¨ë“œì—ì„œëŠ” ê²€ì •ìƒ‰ í…ìŠ¤íŠ¸ */
            }

            thead th {
                background-color: #ffffff; /* ë¼ì´íŠ¸ ëª¨ë“œì—ì„œì˜ ì¹¼ëŸ¼ë°” ë°°ê²½ìƒ‰ */
            }

            /* ë‹¤í¬ ëª¨ë“œ ìŠ¤íƒ€ì¼ */
            body[data-theme='dark'] #jobTable th,
            body[data-theme='dark'] #jobTable td,
            body[data-theme='dark'] #domainFilter label {
                color: #ffffff; /* ë‹¤í¬ ëª¨ë“œì—ì„œëŠ” ë°±ìƒ‰ í…ìŠ¤íŠ¸ */
            }

            body[data-theme='dark'] thead th {
                background-color: #333333; /* ë‹¤í¬ ëª¨ë“œì—ì„œì˜ ì¹¼ëŸ¼ë°” ë°°ê²½ìƒ‰, ì–´ë‘ìš´ ìƒ‰ìœ¼ë¡œ ì¡°ì • */
            }
                /* í…Œì´ë¸” í–‰ì— ë§ˆìš°ìŠ¤ í˜¸ë²„ ì‹œ ë°°ê²½ìƒ‰ ë³€ê²½ - ë‹¤í¬ëª¨ë“œ */
            body[data-theme='dark'] #jobTable tr:hover {
                background-color: #424242; /* ì–´ë‘ìš´ íšŒìƒ‰ìœ¼ë¡œ í˜¸ë²„ ë°°ê²½ìƒ‰ ì„¤ì • */
            }

            #domainFilter input[type="checkbox"] {
                margin-right: 5px;
            }
    
            /* ì—´ ë„ˆë¹„ ì„¤ì • */
            .col-experience { width: 10%; }
            .col-company { width: 15%; }
            .col-domain { width: 10%; }
            .col-role { width: 15%; }
            .col-service { width: 30%; }
            .col-type { width: 10%; }
            .col-deadline { width: 7.5%; }
            .col-registration { width: 7.5%; }

            body {
                --background-color: #ffffff; /* ë¼ì´íŠ¸ëª¨ë“œ ë°°ê²½ìƒ‰ */
                --text-color: #000000; /* ë¼ì´íŠ¸ëª¨ë“œ í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
            }

            @media (prefers-color-scheme: dark) {
                body {
                    --background-color: #121212; /* ë‹¤í¬ëª¨ë“œ ë°°ê²½ìƒ‰ */
                    --text-color: #ffffff; /* ë‹¤í¬ëª¨ë“œ í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
                }
            }

            body {
                background-color: var(--background-color);
                color: var(--text-color);
            }
            .theme-switch-wrapper {
                position: absolute;
                top: 10px;
                right: 10px;
                display: inline-block;
                z-index: 9999;
            }

            .theme-switch {
                display: inline-block;
                height: 24px;
                position: relative;
                width: 48px;
            }

            .theme-switch input {display:none;
            }

            .slider {
                background-color: #ccc;
                bottom: 0;
                cursor: pointer;
                left: 0;
                position: absolute;
                right: 0;
                top: 0;
                transition: .4s;
                border-radius: 24px;
            }

            .slider:before {
                position: relative;
                content: "";
                height: 20px;
                width: 20px;
                left: 4px;
                bottom: 2px;
                background-color: rgb(225, 1, 1);
                transition: .4s;
                border-radius: 50%;
            }

            input:checked + .slider {
                background-color: #4c4c4c;
            }

            .slider.round {
                border-radius: 34px;
            }

            .slider.round:before {
                border-radius: 50%;
            }

            /* ìŠ¤ìœ„ì¹˜ ìŠ¤íƒ€ì¼ ì¡°ì • */
            .light .slider {
                background-image: linear-gradient(to right, orange , #ccc);
                background-size: 200% 100%;
                background-position: left;
            }

            .dark .slider {
                background-image: linear-gradient(to right, #ccc, #4c4c4c);
                background-size: 200% 100%;
                background-position: right;
            }

            /* ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
            .slider:after {
                content: '\2600'; /* í•´ ì•„ì´ì½˜ */
                color: white;
                display: block;
                position: absolute;
                transform: translate(-50%,-50%);
                top: 55%;
                left: 27%;
                font-size: 18px;
                transition: .4s;
            }

            input:checked + .slider:after {
                content: 'ğŸŒ™'; /* ë‹¬ ì•„ì´ì½˜ */
                color: #f1c40f;
                left: 72%;
            }

              /* ë„ë©”ì¸ íƒœê·¸ ìŠ¤íƒ€ì¼ */
            .domain-tag {
                display: inline-block;
                padding: 2px 6px;
                margin: 2px;
                font-size: 14px;
                color: #fff;
                background-color: 	#51A351;
                border-radius: 4px;
                white-space: nowrap;
            }

            body[data-theme='dark'] .domain-tag {
                background-color: #375a7f; /* ë‹¤í¬ ëª¨ë“œì—ì„œì˜ íƒœê·¸ ë°°ê²½ìƒ‰ */
            }
        </style>
        
    </head>
    <body>

<main class="container">
         <!-- í…Œë§ˆ ì „í™˜ ë²„íŠ¼ -->
     <div class="theme-switch-wrapper">
        <label class="theme-switch" for="checkbox">
            <input type="checkbox" id="checkbox" />
            <div class="slider round"></div>
            
        </label>
    </div>
    <h2>ê²½ë ¥ì§ ì±„ìš©</h2>
    <div id="domainFilter">
        <!-- ë„ë©”ì¸ í•„í„°ë§ ì²´í¬ë°•ìŠ¤ë“¤ì´ ì—¬ê¸°ì— ìœ„ì¹˜ -->
    </div>
    <table id="jobTable">
        <thead>
            <tr>
                <th class="col-experience sortable" onclick="sortTable('ìš”êµ¬ ê²½ë ¥', this)">ìš”êµ¬ ê²½ë ¥</th>
                <th class="col-company">íšŒì‚¬ëª…</th>
                <th class="col-domain">ë„ë©”ì¸</th>
                <th class="col-role">í¬ì§€ì…˜</th>
                <th class="col-service">ì„œë¹„ìŠ¤ì†Œê°œ</th>
                <th class="col-type">êµ¬ë¶„</th>
                <th class="col-deadline sortable" onclick="sortTable('ë§ˆê°ì¼', this)">ë§ˆê°ì¼</th>
                <th class="col-registration sortable" onclick="sortTable('ë“±ë¡ì¼', this)">ë“±ë¡ì¼</th>                <th class="col-status">ìƒíƒœ</th> <!-- 'ìƒíƒœ' ì¹¼ëŸ¼ ì¶”ê°€ -->
            </tr>
        </thead>
        <tbody>
            <!-- Table rows will be added here dynamically -->
        </tbody>
    </table>
</main>

<script>
    let jobs = []; // ì§ë¬´ ëª©ë¡ì„ ì €ì¥í•  ë°°ì—´
    let offset = ''; // Airtable í˜ì´ì§•ì„ ìœ„í•œ offset
    let sortState = { column: 'ë“±ë¡ì¼', descending: true, secondary: 'ìš”êµ¬ ê²½ë ¥', secondaryDescending: false };
    let filteredJobs = []; // í•„í„°ë§ëœ ì§ë¬´ ëª©ë¡ 

    async function loadJobs() {
        while (true) {
            let url = 'https://api.airtable.com/v0/appstyiSyDopjQaDG/tble1ZkQmf8IOpRMo';
            if (offset) {
                url += `?offset=${offset}`;
            }

            const response = await fetch(url, {
                headers: {
                }
            });
            const data = await response.json();
            console.log(data);

            let newJobs = data.records.filter(record => record.fields['ìƒíƒœ'] === 'ì±„ìš© ì¤‘');
            jobs = jobs.concat(newJobs);

            offset = data.offset || '';
            if (!offset) break; // ë” ì´ìƒ ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ë°˜ë³µ ì¢…ë£Œ
        }

        filteredJobs = jobs.slice(); // ì´ˆê¸° í•„í„°ë§ëœ ëª©ë¡ì€ ì „ì²´ ì§ë¬´ ëª©ë¡ê³¼ ë™ì¼
        generateDomainFilters();
        sortAndRenderTable(); // ë°ì´í„° ì •ë ¬ ë° í•„í„°ë§ëœ í…Œì´ë¸”ì— ë Œë”ë§
    }

    function generateDomainFilters() {
        const domainSet = new Set(); // ê³ ìœ í•œ ë„ë©”ì¸ ê°’ì„ ì €ì¥í•  Set ê°ì²´ ìƒì„±

        // ëª¨ë“  ì‘ì—… í•­ëª©ì— ëŒ€í•´ ë°˜ë³µí•˜ë©° ë„ë©”ì¸ ê°’ì„ Setì— ì¶”ê°€
        jobs.forEach(job => {
            if (job.fields['ë„ë©”ì¸']) {
                // ë„ë©”ì¸ ê°’ì´ ë°°ì—´ì¸ ê²½ìš° ëª¨ë“  í•­ëª©ì„ ì¶”ê°€, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ë‹¨ì¼ ê°’ì„ ì¶”ê°€
                if (Array.isArray(job.fields['ë„ë©”ì¸'])) {
                    job.fields['ë„ë©”ì¸'].forEach(domain => domainSet.add(domain));
                } else {
                    domainSet.add(job.fields['ë„ë©”ì¸']);
                }
            }
        });

        const sortedDomains = Array.from(domainSet).sort();
        
        const domainFilterDiv = document.getElementById('domainFilter');
        domainFilterDiv.innerHTML = ''; // í•„í„°ë§ ì˜ì—­ ì´ˆê¸°í™”

        // Setì— ì €ì¥ëœ ëª¨ë“  ë„ë©”ì¸ì— ëŒ€í•´ ì²´í¬ë°•ìŠ¤ ìƒì„±
        sortedDomains.forEach(domain => {
            const label = document.createElement('label');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.value = domain;
            checkbox.onchange = filterJobs; // ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë³€ê²½ ì‹œ filterJobs í•¨ìˆ˜ í˜¸ì¶œ
            label.appendChild(checkbox);
            label.appendChild(document.createTextNode(` ${domain}`));
            domainFilterDiv.appendChild(label);
        });
    }

    function filterJobs() {
        const selectedDomains = Array.from(document.querySelectorAll('#domainFilter input:checked')).map(input => input.value);
        filteredJobs = jobs.filter(job => {
            const jobDomains = job.fields['ë„ë©”ì¸'] || [];
            return selectedDomains.length === 0 || selectedDomains.some(domain => jobDomains.includes(domain));
        });

        sortAndRenderTable();
    }

    function sortAndRenderTable() {
        filteredJobs.sort((a, b) => {
            // ì²« ë²ˆì§¸ ì •ë ¬ ê¸°ì¤€: 'ë“±ë¡ì¼'
            let primarySort = compareValues(a, b, sortState.column, sortState.descending);
            if (primarySort !== 0) return primarySort;

            // ë‘ ë²ˆì§¸ ì •ë ¬ ê¸°ì¤€: 'ìš”êµ¬ ê²½ë ¥'
            let secondarySort = compareValues(a, b, sortState.secondary, sortState.secondaryDescending, true);
            if (secondarySort !== 0) return secondarySort;

            // ì„¸ ë²ˆì§¸ ì •ë ¬ ê¸°ì¤€: 'íšŒì‚¬ëª…' (í…ìŠ¤íŠ¸ ìˆœì„œ)
            return compareValues(a, b, 'íšŒì‚¬ëª…', false); // 'íšŒì‚¬ëª…'ì€ í•­ìƒ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ì •ë ¬
        });

        renderTable();
    }

    // ë‚ ì§œ í˜•ì‹ì„ 'yy.mm.dd'ë¡œ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜
    function convertDateFormat(dateString) {
        if (!dateString) return '';
        const [year, month, day] = dateString.split('-'); // 'yyyy.mm.dd' í˜•ì‹ì„ ê°€ì •
        return `${year.slice(2)}.${month}.${day}`; // 'yy.mm.dd' í˜•ì‹ìœ¼ë¡œ ë³€í™˜
    }


    function renderTable() {
        const tableBody = document.getElementById('jobTable').getElementsByTagName('tbody')[0];
        tableBody.innerHTML = ''; // í…Œì´ë¸” ì´ˆê¸°í™”

        filteredJobs.forEach((job, index) => {
            const row = tableBody.insertRow();
            if (index % 2 === 0) {
                row.className = 'even-row'; // ì§ìˆ˜ ë²ˆí˜¸ í–‰ì— 'even-row' í´ë˜ìŠ¤ ì ìš©
            } else {
                row.className = 'odd-row'; // í™€ìˆ˜ ë²ˆí˜¸ í–‰ì— 'odd-row' í´ë˜ìŠ¤ ì ìš©
            }

               // 'ìš”êµ¬ ê²½ë ¥'ê³¼ 'ìš”êµ¬ ê²½ë ¥max' ê°’ì„ ì¡°ê±´ì— ë”°ë¼ ë¬¸ìì—´ ìƒì„±
            const experienceMin = job.fields['ìš”êµ¬ ê²½ë ¥'] || '0'; // 'ìš”êµ¬ ê²½ë ¥'ì´ ì—†ëŠ” ê²½ìš° '0'ìœ¼ë¡œ ì²˜ë¦¬
            const experienceMax = job.fields['ìš”êµ¬ ê²½ë ¥max']; // 'ìš”êµ¬ ê²½ë ¥max' ê°’ í™•ì¸
            const experienceText = experienceMax ? `${experienceMin}-${experienceMax}ë…„` : `${experienceMin}ë…„`; // 'ìš”êµ¬ ê²½ë ¥max' ì¡´ì¬ ì—¬ë¶€ì— ë”°ë¼ ë¬¸ìì—´ ê²°ì •
           
            
            row.insertCell(0).innerText = experienceText;

            const companyCell = row.insertCell(1); // 'íšŒì‚¬ëª…' ì…€ ìƒì„±
            if (job.fields['íšŒì‚¬ëª…(ë§í¬)']) { // 'íšŒì‚¬ëª…(ë§í¬)'ê°€ ìˆëŠ” ê²½ìš°
                const companyLink = document.createElement('a');
                companyLink.href = job.fields['íšŒì‚¬ëª…(ë§í¬)'];
                companyLink.target = '_blank';
                companyLink.textContent = job.fields['íšŒì‚¬ëª…'];
                companyCell.appendChild(companyLink);
            } else {
                companyCell.textContent = job.fields['íšŒì‚¬ëª…']; // ë§í¬ ì—†ì´ í…ìŠ¤íŠ¸ë§Œ ì¶”ê°€
            }

            const domainCell = row.insertCell(2);
            const domains = job.fields['ë„ë©”ì¸'] || [];
            domains.forEach(domain => {
                const domainTag = document.createElement('span'); // íƒœê·¸ë¡œ ì‚¬ìš©í•  span ìš”ì†Œ ìƒì„±
                domainTag.classList.add('domain-tag'); // íƒœê·¸ ìŠ¤íƒ€ì¼ ì ìš©
                domainTag.textContent = domain;
                domainCell.appendChild(domainTag); // ë„ë©”ì¸ ì…€ì— íƒœê·¸ ì¶”ê°€
        });

            
            row.insertCell(3).innerText = job.fields['ì§ë¬´'] || '';
            row.insertCell(4).innerText = job.fields['ì„œë¹„ìŠ¤ì†Œê°œ'] || '';
            row.insertCell(5).innerText = job.fields['êµ¬ë¶„'] || '';
            row.insertCell(6).innerText = convertDateFormat(job.fields['ë§ˆê°ì¼']); // 'ë§ˆê°ì¼'ì„ ìƒˆë¡œìš´ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
            row.insertCell(7).innerText = convertDateFormat(job.fields['ë“±ë¡ì¼']);

            if (job.fields['ì§ë¬´(ë§í¬)']) { // 'ì§ë¬´(ë§í¬)' í•„ë“œê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°ì—ë§Œ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ì¶”ê°€
                row.style.cursor = 'pointer'; // ë§ˆìš°ìŠ¤ ì»¤ì„œë¥¼ í¬ì¸í„°ë¡œ ë³€ê²½
                row.addEventListener('click', function() {
                    window.open(job.fields['ì§ë¬´(ë§í¬)'], '_blank'); // ìƒˆ íƒ­ì—ì„œ 'ì§ë¬´(ë§í¬)' ì—´ê¸°
                });
            }
        });
    }
    function compareValues(a, b, column, descending, numeric = false) {
        let aValue = a.fields[column] || 0;
        let bValue = b.fields[column] || 0;

        // ìˆ«ìë¡œ êµ¬ì„±ëœ ë¬¸ìì—´ì„ ìˆ«ìë¡œ ë³€í™˜
        if (numeric || (!isNaN(aValue) && !isNaN(bValue))) {
            aValue = parseFloat(aValue);
            bValue = parseFloat(bValue);
        }

        if (aValue < bValue) return descending ? 1 : -1;
        if (aValue > bValue) return descending ? -1 : 1;
        return 0;
    }

    function sortTable(column, element) {
        const isDescending = sortState.column === column && !sortState.descending;
        sortState = { ...sortState, column: column, descending: isDescending };

        document.querySelectorAll('.sortable').forEach(th => {
            th.classList.remove('desc');
            if (th.textContent.trim() === column && isDescending) {
                th.classList.add('desc');
            }
        });

        sortAndRenderTable();
    }


    window.onload = function() {
        // ì§ë¬´ ë°ì´í„° ë¡œë“œ
        loadJobs();

        // ë„ë©”ì¸ í•„í„° ì„¹ì…˜ì˜ ë„ˆë¹„ë¥¼ í…Œì´ë¸”ì˜ ë„ˆë¹„ì™€ ë™ì¼í•˜ê²Œ ì„¤ì •
        adjustDomainFilterWidth();

        if(localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            themeSwitch.checked = true;
            document.body.setAttribute('data-theme', 'dark');
        } else {
            themeSwitch.checked = false;
            document.body.setAttribute('data-theme', 'light');
        }
    };

    function adjustDomainFilterWidth() {
        // í…Œì´ë¸” ìš”ì†Œ ì„ íƒ
        var table = document.getElementById('jobTable');
        // ë„ë©”ì¸ í•„í„° ìš”ì†Œ ì„ íƒ
        var domainFilter = document.getElementById('domainFilter');

        // í…Œì´ë¸”ì˜ í˜„ì¬ ë„ˆë¹„ ê°€ì ¸ì˜¤ê¸°
        var tableWidth = table.offsetWidth;

        // ë„ë©”ì¸ í•„í„°ì˜ ë„ˆë¹„ë¥¼ í…Œì´ë¸”ì˜ ë„ˆë¹„ë¡œ ì„¤ì •
        domainFilter.style.width = tableWidth + 'px';
    }
     //í…Œë§ˆ ì „í™˜
    const themeSwitch = document.getElementById('checkbox');
    const switchLabel = document.querySelector('.theme-switch');

    themeSwitch.addEventListener('change', function() {
        if (this.checked) {
            switchLabel.classList.remove('light');
            switchLabel.classList.add('dark');
            document.body.setAttribute('data-theme', 'dark');
        } else {
            switchLabel.classList.remove('dark');
            switchLabel.classList.add('light');
            document.body.setAttribute('data-theme', 'light');
        }
        localStorage.setItem('theme', document.body.getAttribute('data-theme'));
    });


    // í˜ì´ì§€ ë¡œë“œ ì‹œ localStorageì—ì„œ í…Œë§ˆ ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ì ìš©

</script>
</body>
</html>

